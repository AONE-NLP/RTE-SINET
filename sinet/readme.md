here is the core code
